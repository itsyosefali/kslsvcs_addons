================================================================================
CUSTOMER EQUIPMENT - COMPLETE FILE STRUCTURE
================================================================================

kslsvcs_addons/
â”‚
â”œâ”€â”€ ðŸ“„ CUSTOMER_EQUIPMENT_SETUP.txt              â† Detailed setup guide
â”œâ”€â”€ ðŸ“„ CUSTOMER_EQUIPMENT_QUICK_START.txt        â† Quick reference
â”œâ”€â”€ ðŸ“„ CUSTOMER_EQUIPMENT_STRUCTURE.txt          â† This file
â”‚
â””â”€â”€ kslsvcs_addons/
    â”‚
    â”œâ”€â”€ ðŸ“„ hooks.py                               â† UPDATED (scheduler + install hooks)
    â”‚
    â”œâ”€â”€ fixtures/
    â”‚   â”œâ”€â”€ ðŸ“„ __init__.py
    â”‚   â””â”€â”€ ðŸ“„ custom_fields.py                   â† Creates fields in Issue, Sales Order, etc.
    â”‚
    â””â”€â”€ kslsvcs_addons/
        â”‚
        â”œâ”€â”€ ðŸ“ doctype/
        â”‚   â””â”€â”€ customer_equipment/
        â”‚       â”œâ”€â”€ ðŸ“„ __init__.py
        â”‚       â”œâ”€â”€ ðŸ“„ customer_equipment.json            â† DocType definition (15 fields)
        â”‚       â”œâ”€â”€ ðŸ“„ customer_equipment.py              â† Server logic, validations, API
        â”‚       â”œâ”€â”€ ðŸ“„ customer_equipment.js              â† Form behavior, buttons
        â”‚       â”œâ”€â”€ ðŸ“„ customer_equipment_list.js         â† List view customization
        â”‚       â”œâ”€â”€ ðŸ“„ customer_equipment_dashboard.py    â† Dashboard links
        â”‚       â””â”€â”€ ðŸ“„ test_customer_equipment.py         â† Test cases
        â”‚
        â””â”€â”€ ðŸ“ report/
            â”œâ”€â”€ ðŸ“„ __init__.py
            â”‚
            â”œâ”€â”€ equipment_by_customer/
            â”‚   â”œâ”€â”€ ðŸ“„ __init__.py
            â”‚   â”œâ”€â”€ ðŸ“„ equipment_by_customer.json         â† Report definition
            â”‚   â””â”€â”€ ðŸ“„ equipment_by_customer.py           â† Report query & columns
            â”‚
            â”œâ”€â”€ warranty_expiry_report/
            â”‚   â”œâ”€â”€ ðŸ“„ __init__.py
            â”‚   â”œâ”€â”€ ðŸ“„ warranty_expiry_report.json        â† Report definition
            â”‚   â””â”€â”€ ðŸ“„ warranty_expiry_report.py          â† Report with charts
            â”‚
            â””â”€â”€ equipment_maintenance_history/
                â”œâ”€â”€ ðŸ“„ __init__.py
                â”œâ”€â”€ ðŸ“„ equipment_maintenance_history.json â† Report definition
                â””â”€â”€ ðŸ“„ equipment_maintenance_history.py   â† Service history query

================================================================================
TOTAL FILES: 22 files (3 documentation + 19 code files)
================================================================================

ðŸ“Š BREAKDOWN:
   â€¢ DocType: 7 files
   â€¢ Reports: 9 files (3 reports Ã— 3 files each)
   â€¢ Fixtures: 2 files
   â€¢ Documentation: 3 files
   â€¢ Modified: 1 file (hooks.py)

================================================================================
KEY COMPONENTS OVERVIEW
================================================================================

ðŸŽ¯ DOCTYPE: Customer Equipment
   Purpose: Track PBB (Passenger Boarding Bridges) and related assets
   
   Fields (15):
   âœ“ Equipment Name (Data, Required, Unique)
   âœ“ Customer (Link, Required)
   âœ“ Location (Data)
   âœ“ Model Number (Data)
   âœ“ Serial Number (Data, Unique)
   âœ“ Status (Select: Active/In Service/Out of Service/Retired)
   âœ“ Installation Date (Date)
   âœ“ Warranty Expiry (Date)
   âœ“ Linked Project (Link)
   âœ“ Linked Contract (Link)
   âœ“ Notes (Long Text)
   âœ“ Attachments (Attach)
   + System fields (created, modified, owner, etc.)

   Validations:
   âœ“ Warranty date > Installation date
   âœ“ Unique serial numbers
   âœ“ Required fields enforcement

   Server Functions:
   âœ“ get_equipment_maintenance_history(equipment)
   âœ“ get_warranty_expiring_soon(days=30)
   âœ“ send_warranty_expiry_notifications() [Daily scheduler]

   Client Features:
   âœ“ Warranty status indicators (color-coded)
   âœ“ Quick action buttons (Create Issue, View History, Create Sales Order)
   âœ“ Real-time date validation
   âœ“ Auto-fetch customer details

ðŸ“Š REPORTS (3)

   1. Equipment by Customer
      Purpose: List all equipment grouped by customer
      Features:
      - Filter by customer, status
      - Shows: Name, Location, Model, Serial, Dates
      - Exportable to Excel/PDF
      
   2. Warranty Expiry Report
      Purpose: Track warranties expiring soon
      Features:
      - Default: Next 90 days
      - Configurable date range
      - Bar chart visualization
      - Days remaining calculation
      - Only shows Active/In Service equipment
      
   3. Equipment Maintenance History
      Purpose: Service history per equipment
      Features:
      - Shows all linked Issues/Work Orders
      - Filter by equipment or customer
      - Displays: Issue, Subject, Status, Priority, Dates
      - Complete audit trail

ðŸ”— INTEGRATIONS

   Custom Fields Added To:
   âœ“ Issue (Service tracking)
   âœ“ Sales Order (Sales linkage)
   âœ“ Project (Project management)
   âœ“ Sales Invoice (Billing linkage)
   âœ“ Delivery Note (Installation tracking)

   All fields named "equipment" (Link to Customer Equipment)

âš¡ AUTOMATION

   Scheduled Tasks (Daily):
   âœ“ Check warranties expiring in next 30 days
   âœ“ Send notifications to equipment owners
   âœ“ Only for Active/In Service equipment

   Hooks Configuration:
   âœ“ after_install: Creates custom fields automatically
   âœ“ scheduler_events: Runs daily warranty check

================================================================================
INSTALLATION WORKFLOW
================================================================================

STEP 1: Ensure Services Running
   $ bench start
   
STEP 2: Run Migration
   $ bench --site [your-site] migrate
   
   What happens:
   âœ“ Creates tabCustomer Equipment table
   âœ“ Installs 3 reports
   âœ“ Runs after_install hook
   âœ“ Creates custom fields in other doctypes
   âœ“ Sets up permissions

STEP 3: Clear Cache
   $ bench --site [your-site] clear-cache
   
   What happens:
   âœ“ Clears DocType cache
   âœ“ Reloads JavaScript files
   âœ“ Refreshes form definitions

STEP 4: Verify (Optional)
   Navigate to:
   - Home > Kslsvcs Addons > Customer Equipment
   - Check if doctype opens
   - Create a test equipment record
   - Check custom fields in Issue doctype

================================================================================
USAGE FLOW DIAGRAM
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CREATE EQUIPMENT                             â”‚
â”‚                                                                  â”‚
â”‚  Home > Kslsvcs Addons > Customer Equipment > New               â”‚
â”‚  â†’ Fill details (Name, Customer, Location, Dates, Serial)       â”‚
â”‚  â†’ Save                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TRACK SERVICE                                â”‚
â”‚                                                                  â”‚
â”‚  Open Equipment â†’ Click "Create Issue"                          â”‚
â”‚  â†’ Issue auto-linked to equipment                               â”‚
â”‚  â†’ OR: Create Issue manually, select equipment                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     VIEW HISTORY                                 â”‚
â”‚                                                                  â”‚
â”‚  Open Equipment â†’ Click "View Maintenance History"              â”‚
â”‚  â†’ Report shows all Issues linked to this equipment             â”‚
â”‚  â†’ Complete service audit trail                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MONITOR WARRANTY                             â”‚
â”‚                                                                  â”‚
â”‚  â€¢ Dashboard shows color indicator (Green/Orange/Red)           â”‚
â”‚  â€¢ Reports > Warranty Expiry Report â†’ See all expiring          â”‚
â”‚  â€¢ Daily notifications for 30-day warnings                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     LINK TO PROJECTS                             â”‚
â”‚                                                                  â”‚
â”‚  Create Sales Order / Project                                   â”‚
â”‚  â†’ Select Customer â†’ Select Equipment                           â”‚
â”‚  â†’ Auto-linked for tracking across lifecycle                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
API REFERENCE
================================================================================

Python API (Server-side):

1. Get Maintenance History
   ```python
   import frappe
   history = frappe.call(
       'kslsvcs_addons.kslsvcs_addons.doctype.customer_equipment.customer_equipment.get_equipment_maintenance_history',
       equipment='EQUIPMENT-0001'
   )
   ```

2. Get Warranty Expiring Soon
   ```python
   import frappe
   expiring = frappe.call(
       'kslsvcs_addons.kslsvcs_addons.doctype.customer_equipment.customer_equipment.get_warranty_expiring_soon',
       days=30
   )
   ```

3. Manual Notification Trigger
   ```python
   from kslsvcs_addons.kslsvcs_addons.doctype.customer_equipment.customer_equipment import send_warranty_expiry_notifications
   send_warranty_expiry_notifications()
   ```

4. Create Custom Fields
   ```python
   from kslsvcs_addons.fixtures.custom_fields import create_equipment_custom_fields
   create_equipment_custom_fields()
   ```

JavaScript API (Client-side):

1. Create Issue from Equipment
   ```javascript
   frappe.new_doc('Issue', {
       customer: frm.doc.customer,
       equipment: frm.doc.name
   });
   ```

2. Open Maintenance History Report
   ```javascript
   frappe.set_route('query-report', 'Equipment Maintenance History', {
       equipment: frm.doc.name
   });
   ```

================================================================================
TESTING CHECKLIST
================================================================================

â–¡ Create Customer Equipment record
  âœ“ All fields save correctly
  âœ“ Serial number uniqueness enforced
  âœ“ Warranty date validation works

â–¡ Custom Fields Present
  âœ“ Issue has "Equipment" field
  âœ“ Sales Order has "Equipment" field
  âœ“ Project has "Equipment" field

â–¡ Reports Working
  âœ“ Equipment by Customer shows data
  âœ“ Warranty Expiry Report shows data + chart
  âœ“ Maintenance History shows data

â–¡ Client Features
  âœ“ Warranty indicator shows correct color
  âœ“ "Create Issue" button works
  âœ“ "View Maintenance History" button works
  âœ“ Date validation works

â–¡ Automation
  âœ“ Scheduler enabled
  âœ“ Warranty notifications send

================================================================================
PERMISSION MATRIX
================================================================================

Role              Create  Read  Write  Delete  Export  Report  Share
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
System Manager      âœ“      âœ“     âœ“       âœ“       âœ“       âœ“      âœ“
Stock Manager       âœ“      âœ“     âœ“       âœ“       âœ“       âœ“      âœ“
Stock User          âœ—      âœ“     âœ—       âœ—       âœ“       âœ“      âœ“

================================================================================
MAINTENANCE & SUPPORT
================================================================================

Adding New Features:
1. Edit JSON for fields: customer_equipment.json
2. Add logic in: customer_equipment.py
3. Add UI behavior: customer_equipment.js
4. Run: bench --site [site] migrate

Creating New Reports:
1. Create folder in: report/
2. Add .json and .py files
3. Run: bench --site [site] migrate

Modifying Custom Fields:
1. Edit: fixtures/custom_fields.py
2. Run in console:
   >>> from kslsvcs_addons.fixtures.custom_fields import create_equipment_custom_fields
   >>> create_equipment_custom_fields()

================================================================================
CHANGELOG
================================================================================

Version 1.0 - October 15, 2025
- Initial release
- Customer Equipment DocType created
- 3 reports added
- Custom field integrations
- Automated warranty notifications
- Dashboard and list view customizations

================================================================================

